<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ggplot2">
<title>FAQ: Annotation â€¢ ggplot2</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.6/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.6/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="FAQ: Annotation">
<meta property="og:description" content="ggplot2">
<meta property="og:image" content="https://ggplot2.tidyverse.org/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><script defer data-domain="ggplot2.tidyverse.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-none"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ggplot2</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.4.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-news">News</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-news">
    <h6 class="dropdown-header" data-toc-skip>Releases</h6>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2022/11/ggplot2-3-4-0/">Version 3.4.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/03/ggplot2-3-3-0/">Version 3.3.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2019/06/ggplot2-3-2-0/">Version 3.2.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/10/ggplot2-3-1-0/">Version 3.1.0</a>
    <a class="external-link dropdown-item" href="https://www.tidyverse.org/articles/2018/07/ggplot2-3-0-0/">Version 3.0.0</a>
    <a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-2-0/">Version 2.2.0</a>
    <a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-1-0/">Version 2.1.0</a>
    <a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-2-0-0/">Version 2.0.0</a>
    <a class="external-link dropdown-item" href="https://posit.co/blog/ggplot2-updates/">Version 1.0.0</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../news/index.html">Changelog</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ggplot2-specs.html">Aesthetic specifications</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Developer</h6>
    <a class="dropdown-item" href="../articles/extending-ggplot2.html">Extending ggplot2</a>
    <a class="dropdown-item" href="../articles/ggplot2-in-packages.html">Using ggplot2 in packages</a>
    <a class="dropdown-item" href="../articles/profiling.html">Profiling Performance</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>FAQ</h6>
    <a class="dropdown-item" href="../articles/faq-axes.html">FAQ: Axes</a>
    <a class="dropdown-item" href="../articles/faq-faceting.html">FAQ: Faceting</a>
    <a class="dropdown-item" href="../articles/faq-customising.html">FAQ: Customising</a>
    <a class="dropdown-item" href="../articles/faq-annotation.html">FAQ: Annotation</a>
    <a class="dropdown-item" href="../articles/faq-reordering.html">FAQ: Reordering</a>
    <a class="dropdown-item" href="../articles/faq-bars.html">FAQ: Barplots</a>
  </div>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://exts.ggplot2.tidyverse.org/gallery/">Extensions</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/tidyverse/ggplot2/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>FAQ: Annotation</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/tidyverse/ggplot2/blob/HEAD/vignettes/articles/faq-annotation.Rmd" class="external-link"><code>vignettes/articles/faq-annotation.Rmd</code></a></small>
      <div class="d-none name"><code>faq-annotation.Rmd</code></div>
    </div>

    
    
<style>
  .content h3 {
    margin-top: -30px !important;
  }
  
  details {
    margin-bottom: 40px;
  }
</style>
<div class="section level3">
<h3 id="why-is-annotation-created-with-geom_text-pixellated-how-can-i-make-it-more-crisp">Why is annotation created with <code>geom_text()</code> pixellated?
How can I make it more crisp?<a class="anchor" aria-label="anchor" href="#why-is-annotation-created-with-geom_text-pixellated-how-can-i-make-it-more-crisp"></a>
</h3>
<p>You should use <code>annotate(geom = "text")</code> instead of
<code><a href="../reference/geom_text.html">geom_text()</a></code> for annotation.</p>
<details><summary>
See example
</summary><p>In the following visualisation we have annotated a histogram with a
red line and red text to mark the mean. Note that both the line and the
text appears pixellated/fuzzy.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mean_hwy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">$</span><span class="va">hwy</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_segment.html">geom_segment</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">mean_hwy</span>, xend <span class="op">=</span> <span class="va">mean_hwy</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">35</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_text.html">geom_text</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">mean_hwy</span>, y <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"mean\n"</span>, <span class="va">mean_hwy</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-2-1.png" alt="Histogram of highway miles per gallon for 234 cars. A red line is placed at the position 23.44 and is adorned with the label 'mean 23.44'. Both the line and the text appear pixellated due to overplotting." width="80%"></p>
<p>This is because <code><a href="../reference/geom_text.html">geom_text()</a></code> draws the geom once per each
row of the data frame, and plotting these on top of each other. For
annotation (as opposed to plotting the data using text as geometric
objects to represent each observation) use <code><a href="../reference/annotate.html">annotate()</a></code>
instead.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hwy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>binwidth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"segment"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">mean_hwy</span>, xend <span class="op">=</span> <span class="va">mean_hwy</span>, y <span class="op">=</span> <span class="fl">0</span>, yend <span class="op">=</span> <span class="fl">35</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/annotate.html">annotate</a></span><span class="op">(</span><span class="st">"text"</span>,</span>
<span>    x <span class="op">=</span> <span class="va">mean_hwy</span>, y <span class="op">=</span> <span class="fl">40</span>,</span>
<span>    label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"mean ="</span>, <span class="va">mean_hwy</span><span class="op">)</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"red"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-3-1.png" alt="Histogram of highway miles per gallon for 234 cars. A red line is placed at the position 23.44 and is adorned with the label 'mean = 23.44'. Both the line and the text appear crisp." width="80%"></p>
</details>
</div>
<div class="section level3">
<h3 id="how-can-i-make-sure-all-annotation-created-with-geom_text-fits-in-the-bounds-of-the-plot">How can I make sure all annotation created with
<code>geom_text()</code> fits in the bounds of the plot?<a class="anchor" aria-label="anchor" href="#how-can-i-make-sure-all-annotation-created-with-geom_text-fits-in-the-bounds-of-the-plot"></a>
</h3>
<p>Set <code>vjust = "inward"</code> and <code>hjust = "inward"</code>
in <code><a href="../reference/geom_text.html">geom_text()</a></code>.</p>
<details><summary>
See example
</summary><p>Suppose you have the following data frame and visualization. The
labels at the edges of the plot are cut off slightly.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html" class="external-link">tribble</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span><span class="va">x</span>, <span class="op">~</span><span class="va">y</span>, <span class="op">~</span><span class="va">name</span>,</span>
<span>  <span class="fl">2</span>,  <span class="fl">2</span>,  <span class="st">"two"</span>,</span>
<span>  <span class="fl">3</span>,  <span class="fl">3</span>,  <span class="st">"three"</span>,</span>
<span>  <span class="fl">4</span>,  <span class="fl">4</span>,  <span class="st">"four"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_text.html">geom_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-4-1.png" alt="A plot showing the words 'two', 'three' and 'four' arranged diagonally. The 'two' and 'four' labels have been clipped to the panel's edge and are not displayed completely." width="80%"></p>
<p>You could manually extend axis limits to avoid this, but a more
straightforward approach is to set <code>vjust = "inward"</code> and
<code>hjust = "inward"</code> in <code><a href="../reference/geom_text.html">geom_text()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, label <span class="op">=</span> <span class="va">name</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_text.html">geom_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span>, vjust <span class="op">=</span> <span class="st">"inward"</span>, hjust <span class="op">=</span> <span class="st">"inward"</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-5-1.png" alt="A plot showing the words 'two', 'three' and 'four' arranged diagonally. The 'two' and 'four' labels are aligned to the top-right and bottom-left relative to their anchor points, and are displayed in their entirety." width="80%"></p>
</details>
</div>
<div class="section level3">
<h3 id="how-can-i-annotate-my-bar-plot-to-display-counts-for-each-bar">How can I annotate my bar plot to display counts for each bar?<a class="anchor" aria-label="anchor" href="#how-can-i-annotate-my-bar-plot-to-display-counts-for-each-bar"></a>
</h3>
<p>Either calculate the counts ahead of time and place them on bars
using <code><a href="../reference/geom_text.html">geom_text()</a></code> or let <code><a href="../reference/ggplot.html">ggplot()</a></code> calculate
them for you and then add them to the plot using
<code><a href="../reference/geom_bar.html">stat_count()</a></code> with <code>geom = "text"</code>.</p>
<details><summary>
See example
</summary><p>Suppose you have the following bar plot and you want to add the
number of cars that fall into each <code>drv</code> level on their
respective bars.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-6-1.png" alt="A bar chart showing the number of cars for each of three types of drive train." width="80%"></p>
<p>One option is to calculate the counts with
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code> and then pass them to the <code>label</code>
mapping in <code><a href="../reference/geom_text.html">geom_text()</a></code>. Note that we expanded the y axis
limit to get the numbers to fit on the plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">drv</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">110</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-7-1.png" alt="A bar chart showing the number of cars for each of three types of drive train. The count values are displayed on top of the bars as text." width="80%"></p>
<p>Another option is to let <code><a href="../reference/ggplot.html">ggplot()</a></code> do the counting for
you, and access these counts with <code>after_stat(count)</code> that is
mapped to the labels to be placed on the plot with
<code><a href="../reference/geom_bar.html">stat_count()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">stat_count</a></span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"text"</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span>, vjust <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">110</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: The dot-dot notation (`..count..`) was deprecated in ggplot2 3.4.0.</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">â„¹</span> Please use `after_stat(count)` instead.</span></span>
<span><span class="co">#&gt; <span style="color: #555555;">This warning is displayed once every 8 hours.</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">Call `lifecycle::last_lifecycle_warnings()` to see where this warning was</span></span></span>
<span><span class="co">#&gt; <span style="color: #555555;">generated.</span></span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-8-1.png" alt="A bar chart showing the number of cars for each of three types of drive train. The count values are displayed on top of the bars as text." width="80%"></p>
</details>
</div>
<div class="section level3">
<h3 id="how-can-i-annotate-my-stacked-bar-plot-to-display-counts-for-each-segment">How can I annotate my stacked bar plot to display counts for each
segment?<a class="anchor" aria-label="anchor" href="#how-can-i-annotate-my-stacked-bar-plot-to-display-counts-for-each-segment"></a>
</h3>
<p>First calculate the counts for each segment (e.g.Â with
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code>) and then place them on the bars with
<code><a href="../reference/geom_text.html">geom_text()</a></code> using <code>position_stack(vjust = 0.5)</code>
in the <code>position</code> argument to place the values in the middle
of the segments.</p>
<details><summary>
See example
</summary><p>Suppose you have the following stacked bar plot.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, fill <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-9-1.png" alt="A stacked bar chart showing the number of cars for each of seven types of cars. The fill colour of the bars indicate the type of drive train." width="80%"></p>
<p>You can first calculate the counts for each segment with
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code>, which will place these values in a column
called <code>n</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">class</span>, <span class="va">drv</span><span class="op">)</span> </span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 Ã— 3</span></span></span>
<span><span class="co">#&gt;    class      drv       n</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 2seater    r         5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> compact    4        12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> compact    f        35</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> midsize    4         3</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> midsize    f        38</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> minivan    f        11</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> pickup     4        33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> subcompact 4         4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> subcompact f        22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> subcompact r         9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> suv        4        51</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> suv        r        11</span></span></code></pre></div>
<p>You can then pass this result directly to <code><a href="../reference/ggplot.html">ggplot()</a></code>, draw
the segments with appropriate heights with <code>y = n</code> in the
<code>aes</code>thetic mapping and <code><a href="../reference/geom_bar.html">geom_col()</a></code> to draw the
bars, and finally place the counts on the plot with
<code><a href="../reference/geom_text.html">geom_text()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="va">class</span>, <span class="va">drv</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">class</span>, fill <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_text.html">geom_text</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">n</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">3</span>, position <span class="op">=</span> <span class="fu"><a href="../reference/position_stack.html">position_stack</a></span><span class="op">(</span>vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-11-1.png" alt="A stacked bar chart showing the number of cars for each of seven types of cars. The fill colour of the bars indicate the type of drive train. In the middle of each filled part, the count value is displayed as text." width="80%"></p>
</details>
</div>
<div class="section level3">
<h3 id="how-can-i-display-proportions-relative-frequencies-instead-of-counts-on-a-bar-plot">How can I display proportions (relative frequencies) instead of
counts on a bar plot?<a class="anchor" aria-label="anchor" href="#how-can-i-display-proportions-relative-frequencies-instead-of-counts-on-a-bar-plot"></a>
</h3>
<p>Either calculate the proportions ahead of time and place them on bars
using <code><a href="../reference/geom_text.html">geom_text()</a></code> or let <code><a href="../reference/ggplot.html">ggplot()</a></code> calculate
them for you and then add them to the plot using
<code>stat_coun()</code> with <code>geom = "text"</code>.</p>
<details><summary>
See example
</summary><p>Suppose you have the following bar plot but you want to display the
proportion of cars that fall into each <code>drv</code> level, instead
of the count.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-12-1.png" alt="A bar chart showing the number of cars for each of three types of drive train." width="80%"></p>
<p>One option is to calculate the proportions with
<code><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">dplyr::count()</a></code> and then use <code><a href="../reference/geom_bar.html">geom_col()</a></code> to draw
the bars</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mpg</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">drv</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>prop <span class="op">=</span> <span class="va">n</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">prop</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_col</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-13-1.png" alt="A bar chart showing the proportion of cars for each of three types of drive train." width="80%"></p>
<p>Another option is to let <code><a href="../reference/ggplot.html">ggplot()</a></code> do the calculation of
proportions for you, and access these counts with <code>..prop..</code>.
Note that we also need to the <code>group = 1</code> mapping for this
option.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span>, <span class="fu"><a href="../reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">drv</span>, y <span class="op">=</span> <span class="va">..prop..</span>, group <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="faq-annotation_files/figure-html/unnamed-chunk-14-1.png" alt="A bar chart showing the proportion of cars for each of three types of drive train." width="80%"></p>
</details>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="http://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://github.com/wch" class="external-link">Winston Chang</a>, <a href="https://github.com/lionel-" class="external-link">Lionel Henry</a>, <a href="https://data-imaginist.com" class="external-link">Thomas Lin Pedersen</a>, Kohske Takahashi, <a href="https://clauswilke.com" class="external-link">Claus Wilke</a>, <a href="https://karawoo.com" class="external-link">Kara Woo</a>, <a href="https://yutani.rbind.io" class="external-link">Hiroaki Yutani</a>, <a href="https://fishandwhistle.net" class="external-link">Dewey Dunnington</a>, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

  </div></footer>
</body>
</html>
